@model List<Activity>

@if (Model.Count == 0)
{
    <h4 style="padding:45px 20px " class="text-muted text-center"> No Tasks! </h4>
}
else
{
    <div class="d-flex mb-3">
        <div class="btn btn-light btn-lg mr-3 pt-2">
            @Model.FirstOrDefault().Team.Name
        </div>
    </div>


    <table class="table table-hover text-center">
        <thead class="alert-info">
            <tr>
                <th>Name</th>
                <th>Progress</th>
                <th>Start</th>
                <th>Due</th>
                <th>Priority</th>
                <th>Working hours</th>
                <th></th>
            </tr>
        </thead>


        @for (int i = 0; i < Model.Count(); i++)
        {
            <tr id="@Model[i].Id" onclick="getid(this.id)">
                <td>
                    @Model[i].Name
                    <div class="btn-group dropright">
                        <button type="button" class="btn btn-outline-info rounded-circle " style="padding:1px 8px" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-info"></i>
                        </button>
                        <div class="dropdown-menu px-3 mx-1 text-muted">
                            @Model[i].Description
                        </div>
                    </div>
                </td>
                <td><div class="progress"><div class="progress-bar" role="progressbar" style="width: @Model[i].Progress%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">@Model[i].Progress%</div></div></td>
                <td>@Model[i].StartDate.Day @Model[i].StartDate.ToString("MMM") @Model[i].StartDate.Year</td>
                <td>@Model[i].EndDate.Day @Model[i].EndDate.ToString("MMM") @Model[i].EndDate.Year</td>
                <td><select asp-for="@Model[i].Priority" asp-items="@Html.GetEnumSelectList<Priority>()" class="form-control"></select></td>
                <td>@Model[i].ActualDuratoin hours</td>

                <td>
                    @if (Model[i].Progress == 100)
                    {
                        <button onclick="ChangeStatus(@Model[i].Id,2)" class="btn btn-success " style="padding:1px 6px"><i class="fas fa-check"></i></button>
                    }
                    else
                    {
                        <button onclick="ChangeStatus(@Model[i].Id,3)" class="btn btn-danger " style="padding:1px 6px"><i class="fas fa-trash-alt"></i></button>
                    }
                </td>
            </tr>
        }


    </table>
}



<script>
    var id;
    function getid(value) {
        //debugger;
        id = value;
    }

    (function () {
        var previous;


        $("select").on('focus', function () {
            // Store the current value on focus and on change

            previous = this.value;

            // console.log(previous);

        }).change(function () {

            var value = this.value;
            console.log(value);
            //console.log(id);
            switch (value) {
                case '0': //critial
                    if (confirm('Do you want to change priority to critical?')) {
                        EditPriority(id, value);
                    }
                    else {
                        $(`#${id} > td > select`)[0].value = previous
                    }
                    break;


                case '1': //high
                    if (confirm('Do you want to change priority to High?')) {
                        EditPriority(id, value);
                    }
                    else {
                        $(`#${id} > td > select`)[0].value = previous
                    }
                    break;


                case '2': // medium
                    if (confirm('Do you want to change priority to Medium?')) {
                        EditPriority(id, value);
                    }
                    else {
                        $(`#${id} > td > select`)[0].value = previous
                    }
                    break;
                    break;

                case '3': //low
                    if (confirm('Do you want to change priority to Low?')) {
                        EditPriority(id, value);
                    }
                    else {
                        $(`#${id} > td > select`)[0].value = previous
                    }
                    break;
                    break;
            }

        });
    })();


</script>
