
@model ProjectViewModel
@{
    ViewData["Title"] = "Create Project";
}

<div class="container">
    <h3 class="text-muted">Projects</h3>
    <br>
    <!--#region Add project  -->
    <div class=" row mb-3 ">
        <span class=" col-3 ">
            <input class="form-control" type="search" placeholder="Search">
        </span>
        <span class="col-4">
            <button class="btn btn-success " id="addproject">Add project</button>
            <button class="btn btn-light "><i class="fas fa-filter"></i>Filter</button>
            <button class="btn btn-light "><i class="fas fa-arrow-circle-up"></i> Archive</button>
        </span>
    </div>
    <!--#endregion   -->

    <div class="row">
        <div class="col-6">
            <!--#region Create Section  -->
            <div class=" d-none  row mb-3" id="createsection">
                <div class="col-6">
                    <input asp-for="@Model.Project.Name" class="form-control"
                           type="text" id="projectName" placeholder="Enter the name of new project">
                    @Html.ValidationMessageFor(m => m.Project.Name, null, new { @class = "text-danger" })

                </div>
                <div col-6>
                    <button class="btn btn-success " id="Createprojrct"> create new project </button>
                    <button class="btn btn-light " id="cancel">Cancel</button>
                </div>
            </div>
            <!--#endregion -->
            <!--#region Table Section  -->
            <div id="projectsTable" style="border: 2px solid rgb(219, 219, 219) ;   border-radius: 8px;">
                <table class="table table-hover">
                    @if (Model.Projects.Count<Project>() <= 0)
                    {
                        <h4 id="noProject" style="padding:45px 20px " class="text-muted text-center">Create your first project </h4>
                    }
                    <tbody id="tablebody">
                        @foreach (var item in Model.Projects)
                        {
                            <tr id="@item.ID" onclick="Edit(@item.ID)">
                                <td>@item.Name</td>
                                <td>
                                    <span class="btn btn-info "><i id="i" class="fas fa-chart-area"></i> Chart</span>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"/>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <!--#endregion -->
        </div>


        <div id="formSec" class="col-6">
            <!--#region Form Section  -->
            <div style="border: 2px solid rgb(219, 219, 219) ; padding: 50px 25px;  border-radius: 8px;">
                <h4 class="text-muted text-center">Choose project to edit</h4>
            </div>
            <!--#endregion -->
        </div>

    </div>

    <!-- The Modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Modal Heading</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <partial name="_Dashboard" />
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

</div>









@section Scripts{
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>

    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script>

        //open form for add name of project
        var btn = $('#addproject').click(function () {
            $('#addproject').hide();
            $('#createsection').addClass("d-flex");
        })

        //this function is called after add new project also
        function CloseProjrctNameSec() {
            $('#addproject').show();
            $('#createsection').removeClass("d-flex");
        }
        $('#cancel').click(CloseProjrctNameSec)


        //Add Ajax
        $('#projectName').keypress(function (event) {
            var keyCode = (event.keyCode ? event.keyCode : event.which);
            if (keyCode == '13') {
                Add()
            }
        })

        $('#Createprojrct').click(Add);
        function Add() {
            var pName = $('#projectName').val();
            if (pName) {
                $.ajax({
                    type: "POST",
                    url: `/Project/Add`,
                    data: { Name: pName },
                    success: function (response) {
                        $('#tablebody').append(
                            `<tr id="${response.id}" onclick="Edit(${response.id})">
                                                                                <td>${response.name}</td>
                                                                                <td>
                                                                                    <span class="btn btn-info "><i id="i" class="fas fa-chart-area"></i> Chart</span>
                                                                                </td>
                                                                            </tr>`
                        );
                        //For first time if there is no project in the table (Hide the sec of No Project is created)
                        $('#noProject').hide();
                        pName = '';
                        CloseProjrctNameSec();
                        OpenEditSec(response.id)
                    },
                    error: function (x, y, err) {
                        console.log(arguments)
                    }
                });
            }
        }



        //Edit AJAX
        function Edit(projectId) {
            switch (event.target.tagName) {
                case 'SPAN':
                case 'I':
                    location.href = "/Activity/Index/" + projectId;
                    break;
                default:
                    OpenEditSec(projectId);
            }
        }

        //Open the right window which contain the form
        //this function is called from (Edit function , Add function)
        function OpenEditSec(projectId) {
            $.ajax({
                type: "GET",
                url: `/Project/Edit`,
                data: { id: projectId },
                success: function (response) {
                    $('#formSec').replaceWith(response)
                },
                error: function (x, y, err) {
                    console.log(arguments)
                }
            })
        };



        //Submit form ajax
        function SubmitForm(event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: `/project/Edit/`,
                data: $('#projectForm').serialize(),
                success: function (data) {
                    document.getElementById(`${data.id}`).firstElementChild.innerHTML = data.name;
                },
                error: function (x, y, err) {
                    alert("Project name must be entered")
                },
            });
        };
    </script>

}
