@model CommentViewModel

@{
    ViewData["Title"] = "Comments";
}


<div>
    <div class="row upper-container" style="cursor:pointer">
        <div class="col upper-icon " style="display:flex;align-items:center; justify-content:center;">
            <h4 class="text-muted">@Model.SubTasks[0].Task.Name</h4>
        </div>

        <div class="col upper-icon">
            <time class="icon">
                <em>@Model.SubTasks[0].Task.StartDate.DayOfWeek</em>
                <strong>@Model.SubTasks[0].Task.StartDate.ToString("MMMM") </strong>
                <span>@Model.SubTasks[0].Task.StartDate.Day</span>
            </time>
        </div>

        <div class="col upper-icon">
            <time class="icon ">
                <em style="color:rgb(179, 20, 20)">@Model.SubTasks[0].Task.EndDate.DayOfWeek</em>
                <strong style="background-color: rgb(179, 20, 20);
    border-bottom: 1px dashed #1f0203;
    box-shadow: 0 2px 0 rgb(179, 20, 20);">@Model.SubTasks[0].Task.EndDate.ToString("MMMM") </strong>
    <span>@Model.SubTasks[0].Task.EndDate.Day</span>
</time>
</div>


<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    @{ int filesNum = 0;}
    @foreach (var item in Model.Comments)
    {
        if (item.File != null)
        {
            filesNum += 1;
            <div style="margin: 0 .3em 1em 1.5em;">
                <div class="">@item.Sender.UserName</div>
                <div class="ml-2">
                    <a href="#" download="" class="">@item.File.FilePath</a>
                </div>
                <div class="message-time">@item.commentTime</div>
            </div>
        }
    }
</div>


<div class="col " style="display:flex;align-items:center; justify-content:center;"
     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <h4 class="text-muted text-center">@filesNum Files</h4>
</div>


</div>




<div class="row lower-container">
    @for (int i = 0; i < Model.SubTasks.Count(); i++)
    {
        <div class="col-4 task-container ">
            <div style="height:15rem;background-color:white;border:1px solid white ;border-radius:10px 10px 0 0; ">

                <div>
                    <span class="Eng-Name">@Model.SubTasks[i].Engineer.UserName</span>
                    @if (Model.SubTasks[i].Status == Status.OnHold)
                    {
                        <span class="btn-warning"> On Hold</span>
                    }
                </div>

                <div id="@i" style="overflow-y:auto; height:12em">
                    @foreach (var comment in Model.Comments)
                    {
                        if (Model.SubTasks[i].Engineer.Id == Model.Sender)
                        {
                            <div style="margin: 0 .3em 1em .5em;">
                                <div class="message-text">
                                    @comment.comment
                                    @if (comment.File != null)
                                    {
                                        <br>
                                        <a href="#" download="" >@comment.File.FilePath</a>
                                    }
                                </div>
                                <div class="message-time">@comment.commentTime</div>
                            </div>
                        }
                    }
                </div>






                <section id="@Model.SubTasks[i].Id" class="d-none">
                    <div class="single-chart">
                        <svg viewbox="0 0 36 36" class="circular-chart blue">
                            <path class="circle-bg"
                                  d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path class="circle"
                                  stroke-dasharray="@Model.SubTasks[i].Progress, 100"
                                  d="M18 2.0845
                                  a 15.9155 15.9155 0 0 1 0 31.831
                                  a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <text x="18" y="20.35" class="percentage">@Model.SubTasks[i].Progress%</text>
                        </svg>
                    </div>
                </section>

            </div>
            <div class="sub-name" onmouseover="display(@Model.SubTasks[i].Id,@i)" onmouseout="hide(@Model.SubTasks[i].Id, @i)">
                @Model.SubTasks[i].Name
            </div>
        </div>

    }
</div>

</div>



@*<div class="row " style="        border: 2px solid rgb(219, 219, 219);
        border-radius: 8px;">
        <div class="col-3  innerleft pt-4" style="border-right:2px solid rgb(219, 219, 219);">
            @foreach (var item in Model)
            {

                <div class="font-weight-bold mb-2">@item</div>
            }
        </div>
        <div class="col-9 innerright " style="overflow-y:scroll; height:28rem">
            @foreach (var item in Model.Comments)
            {
                if (item.FK_sender == Model.Sender)
                {
                    <div class="message-row you-message">
                        <div class="message-text">
                            @item.comment
                            <br>
                            @if (item.File != null)
                            {
                                <a href="#" download="" class="">@item.File.FilePath</a>
                            }
                        </div>
                        <div class="message-time">@item.commentTime</div>
                    </div>
                }
                else
                {
                    <div class="message-row other-message">
                        <div class="message-text">
                            <div class="user-name">@item.Sender.UserName</div>

                            @item.comment
                            <br>
                            @if (item.File != null)
                            {
                                <a href="#" download="" class="">@item.File.FilePath</a>
                            }
                        </div>
                        <div class="message-time">@item.commentTime</div>
                    </div>
                }
            }
        </div>
    </div>*@


@section Style{
    <style>
        /*.message-row {
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 70%;
        }*/

        .message-text {
            padding: 20px, 14px;
            font-size: 1rem;
            margin-bottom: 0px;
        }

        .message-time {
            font-size: .8rem;
            color: #777;
        }


        .you-message .message-text {
            background-color: rgb(47, 136, 76);
            color: #eee;
            border: 1px solid rgb(47, 136, 76);
            border-radius: 7px 7px 0 7px;
        }

        .user-name {
            font-size: 1rem;
        }

        .other-message .message-text {
            background-color: #eee;
            color: #111;
            border: 1px solid #eee;
            border-radius: 7px 7px 7px 0;
        }

        .you-message {
            justify-content: end;
            justify-items: end;
        }

        .other-message {
            justify-items: start;
        }




        /* Time */

        time.icon {
            font-size: 1em; /* change icon size */
            display: block;
            position: relative;
            width: 5em;
            height: 5em;
            background-color: #fff;
            margin: .4em auto;
            border-radius: 0.6em;
            box-shadow: 0 1px 0 #bdbdbd, 0 2px 0 #fff, 0 3px 0 #bdbdbd, 0 4px 0 #fff, 0 5px 0 #bdbdbd, 0 0 0 1px #bdbdbd;
            overflow: hidden;
        }

            time.icon * {
                display: block;
                width: 100%;
                font-size: 0.9em;
                font-weight: bold;
                font-style: normal;
                text-align: center;
            }

            time.icon strong {
                position: absolute;
                top: 0;
                padding: 0.1em 0;
                color: #fff;
                background-color: var(--green);
                border-bottom: 1px dashed #154826;
                box-shadow: 0 2px 0 var(--green);
            }

            time.icon em {
                position: absolute;
                bottom: 0.3em;
                color: var(--green);
            }

            time.icon span {
                width: 100%;
                font-size: 1.7em;
                letter-spacing: -0.05em;
                padding-top: 0.8em;
                color: #2f2f2f;
            }


        /*My*/

        .upper-container {
            height: 6rem;
            background-color: #e6f5ea;
            margin-top: 6rem;
            border: 0 solid #e6f5ea;
            border-radius: 12px 12px 0 0;
        }

        .lower-container {
            background-color: #e6f5ea;
            margin-top: 1rem;
            border: 0 solid #e6f5ea;
            border-radius: 0 0 12px 12px;
        }

        .upper-icon {
            border-right: 2px solid #cce2d3;
        }

        .Eng-Name {
            font-size: 1.3em;
            border-bottom: 1px solid black;
            margin: .2em 6em 0em .4em;
        }

        .sub-name {
            background-color: var(--green);
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--green);
            border-radius: 0 0 10px 10px;
            font-size: 1.4em;
            color: white;
            transition: .8s;
        }


        .task-container {
            margin: 1.2rem 0 1.2rem 0;
            height: 18rem;
            cursor: pointer;
        }

        section {
            width: 30em;
            position: absolute;
            z-index: 1;
            left: 55px;
            top: 63px;
        }

        .dropdown-menu {
            max-height: 25rem;
            width: 17.7rem;
            overflow-y: auto;
        }
    </style>
    <link rel="stylesheet" href="~/css/circle.css" />
}


@section Scripts{

    <script>

        function display(id, i) {
            $(`#${i}`).addClass('d-none')
            $(`#${id}`).removeClass('d-none')
        }

        function hide(id, i) {
            $(`#${id}`).addClass('d-none')
            $(`#${i}`).removeClass('d-none')
        }
    </script>
}